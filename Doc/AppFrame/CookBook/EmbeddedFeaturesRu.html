<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO 8859-5" /><title>EmbeddedFeaturesRu</title>

</head>
<body>
<h2 style="font-family: Arial;"><small><small>Copyright
(c) Prolog Development Center SPb</small></small></h2>
<h1 style="font-family: Arial;">AppFrame CookBook<br />
</h1>
<h2 style="font-family: Arial;">Встроенные функции<br />
</h2>
<ul style="font-family: Arial;">
<li><a href="#app_language">Язык приложения</a></li>
<li><a href="#gen_dictionary">Генерация словаря
для xml-панели</a></li>
<li><a href="#expand_ribbon">Расширение панели
управления</a></li>
<li><a href="#design_ribbon">Конфигурация панели</a></li>
</ul>
<h3 style="font-family: Arial;"><a name="app_language"></a>Язык
приложения</h3>
<span style="font-family: Arial;">AppFrame включает
механизм выбора языка пользовательского интерфейса.</span><br style="font-family: Arial;" />
<span style="font-family: Arial;">Выбор рабочего языка из
панели управления производится с помощью динамически формируемого меню.</span><br style="font-family: Arial;" />
<span style="font-family: Arial;">Меню
активизируется&nbsp;вызовом предиката&nbsp; команды </span><span style="font-weight: bold; font-family: Arial;"><span style="color: rgb(0, 0, 0);">languageList_Menu</span><span style="color: rgb(160, 0, 0);">()</span></span><span style="color: black; font-family: Arial;"> объекта <span style="font-weight: bold;">fe_Command</span>.<br />
Для формирования списка поддерживаемых языков в xml-конфигурации
приложения &nbsp;узел <span style="font-weight: bold;">language</span>
должен&nbsp;содержать список как показано ниже<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;language
...&gt;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;support flag="ru" id="rus" title="Russian" /&gt;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;support flag="us" id="eng" title="English" /&gt;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;support flag="dk" id="dk" title="Danish" /&gt;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;/language&gt;<br />
</span><br style="font-family: Arial;" />
<span style="font-family: Arial;">Аттрибут </span><span style="font-weight: bold; font-family: Arial;">flag</span><span style="font-family: Arial;">
определяет флаг какой страны &nbsp;должен быть ассоциирован с этим
языком. Аттрибут выбирается на основании суффикса имени иконки флага из
директории&nbsp; </span><br style="font-family: Arial;" />
<span style="color: black; font-family: Arial;"><span style="font-weight: bold; font-style: italic;">Bin\febeAppData\pdcVipIcons\flags</span><span style="font-style: italic;">.</span> Например, имя
флага государства <span style="font-weight: bold;">Азорские
острова</span> представлено как <span style="font-weight: bold;">flag_azores.ico</span>,
соответственно, имя флага в файле конфигурации должно быть указано как <span style="font-weight: bold;">flag="azores"</span>.<br />
Аттрибут <span style="font-weight: bold;">title</span>
определяет какой строкой язык будет представлен в меню, если не
применяется словарь.<br />
Аттрибут <span style="font-weight: bold;">id</span>
определяет идентификатор, по которому будет определяться окончательный
выбор языка.<br />
Фактический идентификатор команды активизации языка имеет строковую
структуру вида &nbsp;</span><span style="font-family: Arial;"><span style="color: black; font-weight: bold;">"ribbon.menu.language.cmd.&lt;id&gt;"</span><span style="color: black;">, где <span style="font-weight: bold;">&lt;id&gt;</span>
означает <span style="font-weight: bold;">id</span>,
указанный в списке языков файла конфигурации.<br />
</span><span style="color: rgb(0, 128, 0);"></span>Соответственно,
идентификатор для </span><span style="font-weight: bold; font-family: Arial;">tooltip</span><span style="font-family: Arial;"> будет иметь вид &nbsp;</span><span style="color: black; font-family: Arial;"></span><span style="font-family: Arial;"><span style="color: black; font-weight: bold;">"ribbon.menu.language.cmd.&lt;id&gt;.tooltip"</span><span style="color: black;">, а идентификатор для menuLabel будет
иметь вид <br />
</span><span style="color: black; font-weight: bold;">"ribbon.menu.language.cmd.&lt;id&gt;.</span></span><span style="color: black; font-weight: bold; font-family: Arial;">menulabel"</span><span style="color: black; font-family: Arial;">.<br />
<br />
Определение команды в файле xml-панели должно выглядеть, например,
следующим образом (обязательные аттрибуты выделены)<br />
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;menu <br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; cmdstyle="image-and-text-vertical" <br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; enabled="true" <br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; <span style="font-weight: bold;">function="language-list"
</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; <span style="font-weight: bold;">id="ribbon.menu.language-list"
</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; label="Language" <br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; <span style="font-weight: bold;">layout="render"
</span><br />
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; style="popupmenu"&gt;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;icon
file="$(pdc-external)\_license-cc\categories\applications-education-language.ico"
/&gt;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;tooltip text="Change UI Language (Render)" /&gt;<br />
<br />
При определении контекста для&nbsp;вызова команды, определенной в
xml-панели должно быть указано<br />
&nbsp;&nbsp;&nbsp; ... &nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; <br />
</span><span style="font-family: Arial;">&nbsp;&nbsp;&nbsp;
<span style="color: rgb(0, 128, 0);">ContextObj</span><span style="color: rgb(160, 0, 0);">:</span><span style="color: rgb(0, 0, 0);">setMenuRender</span><span style="color: rgb(160, 0, 0);">(</span><span style="color: rgb(39, 143, 173);">"language-list"</span><span style="color: black;">,fe_Command():</span><span style="color: rgb(0, 0, 0);">languageList_Menu</span><span style="color: rgb(160, 0, 0);">),<br />
&nbsp;&nbsp;&nbsp; ...<br />
</span></span><br style="font-family: Arial;" />
<span style="font-family: Arial;">Что и связывает
xml-панель c активизацией меню в объекте &nbsp;</span><span style="color: black; font-family: Arial;"><span style="font-weight: bold;">fe_Command.<br />
<br />
</span>Если
предусматривается применение словаря для меню команды выбора языка, то
&nbsp;должен быть активизирован словарь, определенный в файле<br />
<span style="font-weight: bold; font-style: italic;">bin\febeAppData\ribbonLanguage_Dictionary.xml</span>
c <span style="font-weight: bold;">namespace="language".<br />
<br />
</span>Директория<span style="font-weight: bold;">
&nbsp;</span><span style="font-weight: bold; font-style: italic;">bin\febeAppData</span>
содержит файл xml-панели <span style="font-weight: bold;">ribbonLanguageRender.xml</span>,
который может быть использован.<br />
<br />
Все
необходимые операции обмена данными между FrontEnd и BackEnd,
переименования элементов пользовательского интерфейса ядра выполняются
далее автоматически.<br />
Для элементов пользовательского интерфейса,
активных на момент изменения языка должны быть инициированы операции
замены текстовых названий после выполнения операции загрузки словарей в
объекте fe_CoreTasks<br />
<br />
</span><span style="font-family: Arial;"><span style="color: rgb(128, 128, 0);">clauses</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(0, 0, 0);">setNewLanguage</span><span style="color: rgb(160, 0, 0);">(</span><span style="color: rgb(0, 128, 0);">NewLanguageID</span><span style="color: rgb(160, 0, 0);">):-</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(0, 0, 0);">request</span><span style="color: rgb(160, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">methodChain</span><span style="color: rgb(160, 0, 0);">,</span><span style="color: rgb(0, 0, 0);">fe_UpdateUILanguage_C</span><span style="color: rgb(160, 0, 0);">,</span>&nbsp;<span style="color: rgb(0, 0, 0);">s</span><span style="color: rgb(160, 0, 0);">(</span><span style="color: rgb(0, 128, 0);">NewLanguageID</span><span style="color: rgb(160, 0, 0);">)),</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(0, 0, 0);">fe_Dictionary</span><span style="color: rgb(160, 0, 0);">():</span><span style="color: rgb(0, 0, 0);">currentLanguage_P</span><span style="color: rgb(160, 0, 0);">:=</span><span style="color: rgb(0, 128, 0);">NewLanguageID</span><span style="color: rgb(160, 0, 0);">,<br />
</span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(128, 128, 128);">%&nbsp;change&nbsp;here&nbsp;text&nbsp;titles&nbsp;for&nbsp;user-defined
active elements&nbsp;of&nbsp;the&nbsp;UI</span><br />
<span style="color: rgb(160, 0, 0);">&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; <span style="color: black;">success().</span><br />
</span></span><br style="font-family: Arial;" />
<span style="color: black; font-family: Arial;">или в
объекте fe_Command<br />
</span><span style="font-family: Arial;"><br />
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(0, 0, 0);">defaultHandler</span><span style="color: rgb(160, 0, 0);">(</span><span style="color: rgb(0, 128, 0);">CommandID</span><span style="color: rgb(160, 0, 0);">,</span><span style="color: rgb(160, 192, 160);">_NameSpace</span><span style="color: rgb(160, 0, 0);">,</span><span style="color: rgb(160, 192, 160);">_RibbonCmdID</span><span style="color: rgb(160, 0, 0);">):-</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(0, 0, 0);">string</span><span style="color: rgb(160, 0, 0);">::</span><span style="color: rgb(0, 0, 0);">hasPrefixIgnoreCase</span><span style="color: rgb(160, 0, 0);">(</span><span style="color: rgb(0, 128, 0);">CommandID</span><span style="color: rgb(160, 0, 0);">,</span><span style="color: rgb(39, 143, 173);">"ribbon.menu.language.cmd."</span><span style="color: rgb(160, 0, 0);">,</span><span style="color: rgb(0, 128, 0);">Language</span><span style="color: rgb(160, 0, 0);">),</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(0, 0, 0);">fe_CoreTasks</span><span style="color: rgb(160, 0, 0);">():</span><span style="color: rgb(0, 0, 0);">setNewLanguage</span><span style="color: rgb(160, 0, 0);">(</span><span style="color: rgb(0, 128, 0);">Language</span><span style="color: rgb(160, 0, 0);">),</span><br />
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(128, 128, 128);">%&nbsp;change&nbsp;here&nbsp;text&nbsp;titles&nbsp;for&nbsp;user-defined
active elements&nbsp;of&nbsp;the&nbsp;UI</span><br />
<span style="color: rgb(160, 0, 0);">&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp; <span style="color: black;">success().</span></span><br />
<br />
Для работы механизма смены языков в файле конфигурации узел <span style="font-weight: bold;">language</span> должен
иметь аттрибут&nbsp; <span style="font-weight: bold;">use-dictionary="yes"</span>.<br />
</span>
<h3 style="font-family: Arial;"><a name="gen_dictionary"></a>Генерация
словаря для xml-панели</h3>
<span style="font-family: Arial;">Ядро AppFrame включает
инструмент создания и модификации файла словаря для xml-панели.</span><br style="font-family: Arial;" />
<span style="font-family: Arial;">Эту функцию выполняет
класс &nbsp;</span><span style="font-weight: bold; font-family: Arial;">fe_CreateOrModifyRbnDictionary</span><span style="font-family: Arial;">, который во FrontEnd создает
диалог, отвечающий за выполнение&nbsp;задачи.</span><br style="font-family: Arial;" />
<span style="font-family: Arial;">Вызов диалога
&nbsp;из объекта класса </span><span style="font-weight: bold; font-family: Arial;">fe_CoreTasks</span><br style="font-family: Arial;" />
<span style="font-family: Arial;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(0, 0, 0);">fe_CreateOrModifyRbnDictionary</span><span style="color: rgb(160, 0, 0);">::</span><span style="color: rgb(0, 0, 0);">new</span><span style="color: rgb(160, 0, 0);">(</span><span style="color: rgb(0, 0, 0);">frontEnd_P</span><span style="color: rgb(160, 0, 0);">):</span><span style="color: rgb(0, 0, 0);">onCreateOrModifyRbnDictionary</span><span style="color: rgb(160, 0, 0);">(</span><span style="color: rgb(160, 0, 0);">).<br />
<br />
<span style="color: black;">При
вызове этого предиката FrontEnd обращается к BackEnd и получает список
файлов xml-панелей и связанные с каждым из них словарем.</span><br />
<br />
</span>При этом появляется диалог как показано ниже</span><br style="font-family: Arial;" />
<br style="font-family: Arial;" />
<img style="width: 436px; height: 251px; font-family: Arial;" alt="" src="Pictures/CreateOrModify_DictionaryDialog.PNG" /><br style="font-family: Arial;" />
<br style="font-family: Arial;" />
<span style="font-family: Arial;">В выпадающем списке </span><span style="font-weight: bold; font-family: Arial;">Ribbon Script
FileName </span><span style="font-family: Arial;">представлен
набор xml-панелей, хранящихся в директории </span><span style="font-weight: bold; font-family: Arial;">bin\&lt;projectName&gt;AppData</span><span style="font-family: Arial;"> в контексте </span><span style="font-weight: bold; font-family: Arial;">BackEnd</span><span style="font-family: Arial;">, а по кнопке </span><span style="font-weight: bold; font-family: Arial;">Browse...</span><span style="font-family: Arial;"> можно выбрать файл из любой
директории в контексте&nbsp;</span><span style="font-weight: bold; font-family: Arial;">FrontEnd</span><span style="font-family: Arial;">.</span><br style="font-family: Arial;" />
<span style="font-family: Arial;">Поле </span><span style="font-weight: bold; font-family: Arial;">Dictionary
NameSpace</span><span style="font-family: Arial;">
представляет имя NameSpace, свазянное с файлом xml-панели (пусто, если
не установлено).</span><br style="font-family: Arial;" />
<span style="font-family: Arial;">Поле </span><span style="font-weight: bold; font-family: Arial;">Dictionary
FileName</span><span style="font-family: Arial;">
определяет относительное имя&nbsp;файла словаря (относительно
директории </span><span style="font-weight: bold; font-family: Arial;">Bin</span><span style="font-family: Arial;">, пусто если не установлено).</span><br style="font-family: Arial;" />
<span style="font-family: Arial;">Флаг </span><span style="font-weight: bold; font-family: Arial;">Modify Source
Script</span><span style="font-family: Arial;">
устанавливает, надо ли корректировать имя файлв словаря и nameSpace в
файле xml-панели. Если флаг установлен, то содержимое файла панели
корректируется.</span><br style="font-family: Arial;" />
<br style="font-family: Arial;" />
<span style="font-family: Arial;">Для построения начальных
значений текстовых
фраз используются&nbsp; идентификаторы команд и меню и
соответствующие
текстовы фразы,&nbsp;которые представлены в &nbsp;файле
xml-панели.</span><br style="font-family: Arial;" />
<span style="font-family: Arial;">Фразы
генерируются для всех языков, поддержка которых предусмотрена в файле
конфигурации. Для всех языков фраза генерируется та, которая указана в
файле xml-панели (на базовом языке приложения). Пользователь затем
должен вручную перевести фразы для соответствующего языка.</span><br style="font-family: Arial;" />
<br style="font-family: Arial;" />
<span style="font-family: Arial;">Одновременно в словаре
генерируются фразы для </span><span style="font-weight: bold; font-family: Arial;">manuLabel</span><span style="font-family: Arial;"> и </span><span style="font-weight: bold; font-family: Arial;">tooltip</span><span style="font-family: Arial;">.</span><br style="font-family: Arial;" />
<span style="font-weight: normal; font-family: Arial;">Если
текст xml-панели изменен, то при выполнении создания-модификации
словаря создаются текстовые фразы только новых &nbsp;элементов.
Существующе фразы не изменяются.</span><br style="font-family: Arial;" />
<h3 style="font-family: Arial;"><a name="expand_ribbon"></a>Расширение
панели управления</h3>
<span style="font-family: Arial;">Ядро AppFrame включает
инструмент расширения панели управления.<br />
<br />
Для расширения панели вызывается предикат <span style="font-weight: bold;"></span><span style="color: rgb(0, 0, 0);">addExtension</span><span style="color: rgb(160, 0, 0);">()</span> объекта
класса&nbsp;<span style="color: rgb(0, 0, 0);">fe_CoreTasks</span><span style="color: rgb(160, 0, 0);"></span><span style="color: rgb(0, 0, 0);"></span>.<br />
Предикат
addExtension() вызывает процесс обмена сообщениями между FrontEnd и
BackEnd. В результате FrontEnd получает список файлов xml-панелей и
вызывает диалог, приведенный ниже<br />
<br />
<img style="width: 408px; height: 225px;" alt="" src="Pictures/ExpandRibbon.PNG" /><br />
<br />
После выбора имени файла xml-панели справа к действующей панели
добавляется новый фрагмент панели.</span><br style="font-family: Arial;" />
<span style="font-family: Arial;">Удаление
фрагментов панели в текущей версии не предусматривается и может быть
выполнено удалением подузлов &lt;ext&gt; в файле конфигурации
приложения.</span>
<h3 style="font-family: Arial;"><a name="design_ribbon"></a>Конфигурация
панели</h3>
<span style="font-family: Arial;">Конфигурация панели
изменяется вызовом редактора конфигурации панели.</span><br style="font-family: Arial;" />
<span style="font-family: Arial;">Вызов редактора
осуществляется предикатом <span style="color: rgb(0, 0, 0); font-weight: bold;">designRibbonLayout</span><span style="color: rgb(160, 0, 0);"><span style="font-weight: bold;">()</span><span style="color: black;"> объекта класса <span style="font-weight: bold;">fe_Comamnd</span>.<br />
Редактор конфигурации панели позволяет перемещать и удалять команды,
создавать новые и удалять секции панели.<br />
После закрытия редактора новая конфигурация панели сохраняется в файле
конфигурации приложения.<br />
При запуске приложения конфигурация панели восстанавливается до
положения закрытия.<br />
Восстановление конфигурации панели, включающей все расширения,
осуществляется предикатом &nbsp;</span></span><span style="color: rgb(0, 0, 0); font-weight: bold;">reloadRibbon</span><span style="color: black;"><span style="font-weight: bold;">()</span>
объекта класса <span style="font-weight: bold;">fe_Command</span>.</span></span><br style="font-family: Arial;" />
<span style="font-family: Arial;"><span style="color: rgb(160, 0, 0);"><span style="color: black;"><br />
<br />
<br />
<br />
</span></span></span><span style="color: rgb(0, 0, 0); font-size: medium; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; font-family: Arial;"><span></span></span>
</body></html>